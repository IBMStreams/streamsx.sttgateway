<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="SPL File IAMAccessTokenGenerator.spl"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_compilationunit"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>SPL File IAMAccessTokenGenerator.spl</title>
</head>
<body id="spldoc_compilationunit">


<h1 class="title topictitle1">SPL File <tt class="ph tt">IAMAccessTokenGenerator.spl</tt></h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">Gateway to the IBM Speech To Text (STT) cloud service</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.sttgateway.html">com.ibm.streamsx.sttgateway 2.3.0</a> &gt; <a class="xref" href="ns$com.ibm.streamsx.sttgateway.watson.html">com.ibm.streamsx.sttgateway.watson</a> &gt; IAMAccessTokenGenerator.spl</p>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Content</h2>
  
  <dl class="dl">
    <dt class="dt dlterm"/>
<dd class="dd"/>

    
      <dt class="dt dlterm splhead-2">Operators</dt>

      <dd class="dd">
<ul class="sl simple">
<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.sttgateway.watson$IAMAccessTokenGenerator.html#spldoc_compilationunit__composite_operator__IAMAccessTokenGenerator">IAMAccessTokenGenerator</a></strong>: IBM Streams applications using the streamsx.sttgateway can use/invoke this non-main composite to submit,  generate and periodically refresh the IAM access token which will be required by the WatsonSTT operator.
</li>

</ul>

      </dd>

    
    
      <dt class="dt dlterm splhead-2">Types</dt>

      <dd class="dd">
<ul class="sl simple">
<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.sttgateway.watson$IAMAccessTokenGenerator.html#spldoc_compilationunit__type__IAMAccessToken">IAMAccessToken</a></strong>: This type represents the data format for the  result returned by the <em class="ph i">IAMAccessTokenGenerator</em> 
</li>

</ul>

      </dd>

    
  </dl>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Composites</h2>
  
</div>

<div class="section" id="spldoc_compilationunit__composite_operator__IAMAccessTokenGenerator"><h2 class="title sectiontitle splpart">composite IAMAccessTokenGenerator(output stream&lt;IAMAccessToken&gt; IamAccessTokenStream)</h2>
  
</div>

<div class="section splgraph">
  <embed class="image" src="../../image/tk$com.ibm.streamsx.sttgateway/op$com.ibm.streamsx.sttgateway.watson$IAMAccessTokenGenerator.svg" width="142" height="109"/>
</div>

<div class="section">

<p class="p">IBM Streams applications using the streamsx.sttgateway can use/invoke this non-main composite to submit,  generate and periodically refresh the IAM access token which will be required by the WatsonSTT operator.  Without having an unexpired IAM access token, STT service on public cloud will not allow the speech to text  transcription to happen.
</p>

<div class="p">This operator has 2 operation modes: 
<ul class="ul">
<li class="li"> If parameter <em class="ph i">accessToken</em> is nonempty, the operator emits <strong class="ph b">one output tuple</strong> with the access token and the operator </li>

</ul>
thread ends.
<ul class="ul">
<li class="li"> If parameter <em class="ph i">accessToken</em> is empty, the operator connects to the IAM authorization service specified by parameter </li>

</ul>
<tt class="ph tt">iamTokenURL</tt> and requests an access token by using the provided <tt class="ph tt">apiKey</tt>. The received access token is submitted to  the output port. This operator refreshes the access token automatically after the expiration time by using the received  refresh token and submits the refreshed access token to the output port.  If IAM authentication server responses with a non successful result, the operator re-tries the operation after <em class="ph i">failureRetryDelay</em>. 
</div>

<p class="p">The operator gets the configuration information from operator parameters. These values may be overwritten from Streams Application  Configuration properties if an Application Configuration with name defined by parameter <em class="ph i">appConfigName</em> and the appropriate  property exists.
</p>

<p class="p"><strong class="ph b">Metrics:</strong> The following metrics are available if the operator generates and refreshes the access token from IAM authorization  service (parameter <em class="ph i">accessToken</em> is empty).
</p>

<p class="p"><em class="ph i">nSuccessfulInitialRequests:</em>	The number of successful requests with grant_type=urn:ibm:params:oauth:grant-type:apikey.  The authorization was granted in response to the request
</p>

<p class="p"><em class="ph i">nSuccessfulRefreshRequests:</em>	"The number of successful requests with grant_type=refresh_token.  The authorization  was granted in response to the request.
</p>

<p class="p"><em class="ph i">nRequestsFailed:</em>	The cumulative number of requests which return an error status or with invalid response body.
</p>

<p class="p"><em class="ph i">nConnectionAttemptsFailed</em>:	The cumulative number of failed connection attempts.
</p>

<p class="p"><em class="ph i">nConnectionAttemptsCurrent</em>:	The number of current consecutive connection attempts until the connection succeeds.  If an connection attempt succeeds, this metric is reset to 0.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Parameters</h2>

<ul class="sl simple">
<li class="sli"><strong class="ph b">appConfigName</strong>: The name of the application configuration to look for connection parameters. If this parameter  is nonempty, the properties from this application configuration overwrite the operator parameters. An empty string  disables the lookup in the Application Configuration. This may be used if all non default parameters are supplied in the operator  invocation.  Type: <em class="ph i">rstring</em>; Default: <em class="ph i">sttConnection</em> 
</li>

<li class="sli"><strong class="ph b">accessToken</strong>: If parameter <em class="ph i">accessToken</em> is nonempty, the operator emits <strong class="ph b">one output tuple</strong> with the  access token and the operator thread ends. If parameter <em class="ph i">accessToken</em> is empty, the operator connects to the  IAM authorization service specified by parameter <tt class="ph tt">iamTokenURL</tt> and requests an access token by using the provided <tt class="ph tt">apiKey</tt>.  If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">accessToken</em> exists, this parameter is overwritten.  Type: <em class="ph i">rstring</em>; Default: <em class="ph i">""</em> 
</li>

<li class="sli"><strong class="ph b">apiKey</strong>: The api key required for the generation of the access token. This parameter is evaluated  when the operator logic starts to generate a initial or a refresh access token. Thus the  parameter may be changed during operation of the streams application. If the value is the <em class="ph i">empty  string</em>, no access token is requested from IAM cloud service. When the value has changed,  the operator requests an initial access token when the current token becomes invalid.  If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">apiKey</em> exists, this parameter is overwritten.  Type: <em class="ph i">rstring</em>; Default: <em class="ph i">""</em> 
</li>

<li class="sli"><strong class="ph b">iamTokenURL</strong>: The service url of the IAM Token authorization service to fetch and refresh the IAM access  token. If the parameter is the empty string, the operator thread ends immediately. If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">iamTokenURL</em> exists, this parameter is overwritten.  Type <em class="ph i">rstring</em>; Default: the <em class="ph i">empty string</em> 
</li>

<li class="sli"><strong class="ph b">defaultExpiresIn</strong>: The default value for the access token expiration time in seconds. This value is used, when no  expires_in value is returned from the authorization service.  If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">defaultExpiresIn</em> exists, this parameter is overwritten.  Type: <em class="ph i">int64</em>; Default: <em class="ph i">3600</em> 
</li>

<li class="sli"><strong class="ph b">guardTime</strong>: The guard time in seconds. A refresh token is requested 'guard time' seconds before the expiration  was determined.  If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">guardTime</em> exists, this parameter is overwritten.  Type: <em class="ph i">int64</em>; Default: <em class="ph i">300</em> 
</li>

<li class="sli"><strong class="ph b">maxRetryDelay</strong>: The maximum wait time in seconds before a connection re-try is made. The connection re-try  delay increases exponentially starting from 2 seconds but not exceeding 'maxRetryDelay'. This value is used  in case of unsuccessful connection attempts due to (temporary) network issues.  If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">maxRetryDelay</em> exists, this parameter is overwritten. Type: <em class="ph i">float64</em>; Default: <em class="ph i">60.0</em> 
</li>

<li class="sli"><strong class="ph b">failureRetryDelay</strong>: The maximum wait time in seconds before a new authorization attempt is made after a non successful server response. This value is used in case of unsuccessful authorization attempts due to a final failure  response from the authorization server or due to an empty <em class="ph i">apiKey</em>.  If the application configuration with name <em class="ph i">appConfigName</em> and property <em class="ph i">failureRetryDelay</em> exists, this parameter is overwritten. Type: <em class="ph i">float64</em>; Default <em class="ph i">120.0</em> 
</li>

<li class="sli"><strong class="ph b">initDelay</strong>: The initial delay before the operation starts in seconds. Type: <em class="ph i">float64</em>; Default <em class="ph i">0.0</em> 
</li>

<li class="sli"><strong class="ph b">expiresInTestValue</strong>: This value is used mainly for tests. If this value is different from <em class="ph i">0.0</em>, it  overwrites the received expires_in value. Type <em class="ph i">float64</em>; Default <em class="ph i">0.0</em> 
</li>

</ul>

</div>

<div class="section">
</div>

<div class="section"><h2 class="title sectiontitle">Output Ports</h2>

<ul class="sl simple">
<li class="sli"><strong class="ph b">IamAccessTokenStream</strong>: The output stream with the generated access token and other information received  from IAM authentication service. The stream must be of type <a class="xref" href="spl$com.ibm.streamsx.sttgateway.watson$IAMAccessTokenGenerator.html#spldoc_compilationunit__type__IAMAccessToken">com.ibm.streamsx.sttgateway.watson::IAMAccessToken</a>.  The output generates a tuple once a initial or refreshed access token is available. 
</li>

</ul>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Types</h2>
  
</div>

<div class="section" id="spldoc_compilationunit__type__IAMAccessToken"><h2 class="title sectiontitle splpart">IAMAccessToken</h2>
  
</div>
<div class="section">

<p class="p">This type represents the data format for the  result returned by the <em class="ph i">IAMAccessTokenGenerator</em> 
</p>

</div>

<div class="section">
   <p class="p">
<tt class="ph tt">IAMAccessToken = rstring access_token, rstring refresh_token, rstring scope, int64 expiration, rstring token_type, int64 expires_in;</tt>
   </p>

</div>

</div>


</body>
</html>