Wednesday, September/08/2021
============================
(Prepared by Senthil Nathan at IBM)

Steps needed to convert (8KHz, stereo) WAV files to track (channel) specific MuLaw formatted files. 

1) If not done already, scrub the confidential personal information in all your recorded two track (i.e. two channel) WAV files using the free of cost Audacity open source tool by substituting such sensitive speech portions with silence. You have to do it for both the tracks (channels) in every recorded WAV file. Please make sure that your scrubbed two channel files are named as shown below.

call01.wav
call02.wav
call03.wav
call04.wav
...
call17.wav

2) In your RHEL7 Linux machine, login using your user id.

3) Run this command to ensure that you have the sox tool available in your machine.

which sox

[sox is a Sound eXchange tool also known as the Swiss Army knife of audio manipulation. It should be available in your /usr/bin directory. If it is not available, you have to ask your sys admin to install it for you.]

4) mkdir ~/wav-recorded-calls

5) cd ~/wav-recorded-calls

6) Copy all your scrubbed two channel stereo WAV files into this directory. 

call01.wav
call02.wav
call03.wav
... 
call17.wav 

7) Run the following command to split the individual tracks (channels) from your two channel WAV files. 

for x in call??.wav; do y="${x%.wav}"; echo "$y"; sox "$x" "${y}-1-mulaw.wav" remix 1; sox "$x" "${y}-2-mulaw.wav" remix 2; done 

This will split each call into two WAV files as shown below i.e. one file for channel 1 (agent) and the other file for channel 2 (customer). 

call01-1-mulaw.wav, call01-2-mulaw.wav, 
call02-1-mulaw.wav, call02-2-mulaw.wav,Â  
call03-1-mulaw.wav, call03-2-mulaw.wav, 
...,
call17-1-mulaw.wav, call17-2-mulaw.wav

8) Run this command to convert all the channel specific WAV files to MuLaw formatted bin files now.

for x in *-mulaw.wav; do y="${x%.wav}"; echo "$y"; sox -V "$x" -r 8000 -c 1 -t ul "${y}.bin"; done

9) If the conversion worked correctly, you should now see all your converted Mulaw files with .bin file extension. Please count *.bin to confirm that you have the correct number of such converted files.

ls -1 *.bin | wc -l

10) You can now move *.bin from this directory to your call replay directory that you normally use to test it with the IBM Streams real-time speech to text solution.

11) You may now delete ~/wav-recorded-calls/*.wav if you no longer need them at this location.

12) At this time, do the additional prep work necessary to replay these calls to the IBM Streams solution in order for it to start transcribing them.
=========================
If you have a need to convert the call recording result files generated by the IBM Streams solution into individual single track WAV files, you can follow these steps.

If you have the ffmpeg utility, you can follow these steps
----------------------------------------------------------
ffmpeg -f mulaw -ar 8000 -i XXXXX-1-mulaw.bin -codec:a pcm_mulaw XXXXX-1.wav
ffmpeg -f mulaw -ar 8000 -i XXXXX-2-mulaw.bin -codec:a pcm_mulaw XXXXX-2.wav

If you have the sox utility, you can follow these steps
-------------------------------------------------------
a) You have to take a copy of the two mulaw bin files for every call.

cp -p XXXXX-1-mulaw.bin XXXXX-1.ul
cp -p XXXXX-2-mulaw.bin XXXXX-2.ul

b) You can convert the mulaw files to wav files by running these commands.
sox -V XXXXX-1.ul -r 8000 -c 1 XXXXX-1.wav
sox -V XXXXX-2.ul -r 8000 -c 1 XXXXX-2.wav

c) You may now delete the *.ul files if you have no need for them anymore.
=========================
If you have a need to convert the two channel mulaw files into a dual track WAV file,
you can follow these steps.

1) Copy your channel specific mulaw files so that they have the extension of .ul instead of .mulaw. 

2) Run this command to mix them into a single WAV file with two tracks.

sox -m xxxx-1.ul xxxx-2.ul xxxx.wav 

You can also mix them into a single mulaw file suitable for use in the VoiceDataSimulator application of the streamsx.sttgateway toolkit.

sox -m xxxx-1.ul xxxx-2.ul xxxx.ul
mv xxxx.ul xxxx.mulaw

You may now delete the .ul files if they are not needed.
=========================
